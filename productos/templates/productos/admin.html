{% extends 'coimpres_cuba/base.html' %}
{% load static %}

{% block title %}Panel de Administraci√≥n - Productos{% endblock %}

{% block extra_css %}
<style>
    .admin-container {
        max-width: 1200px;
        width: 100%;
        margin: 0 auto;
        padding: 15px;
    }
    
    .admin-header {
        text-align: center;
        margin-bottom: 20px;
        padding: 15px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 10px;
    }
    
    .admin-tabs {
        display: flex;
        justify-content: flex-start;
        margin-bottom: 20px;
        border-bottom: 1px solid #ddd;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        white-space: nowrap;
        -ms-overflow-style: none;
    }
    
    .admin-tabs::-webkit-scrollbar {
        display: none;
    }
    
    .tab-button {
        background: none;
        border: none;
        padding: 12px 20px;
        margin: 0 3px;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        font-weight: 500;
        color: #666;
        transition: all 0.3s ease;
        white-space: nowrap;
        font-size: 14px;
    }
    
    .tab-button.active {
        color: #667eea;
        border-bottom-color: #667eea;
    }
    
    .tab-button:hover {
        color: #667eea;
        background-color: #f8f9fa;
    }
    
    .tab-content {
        display: none;
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
    }
    
    .tab-content.active {
        display: block;
    }
    
    .form-grid {
        display: grid;
        gap: 15px;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }
    
    .form-group {
        margin-bottom: 15px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 6px;
        font-weight: 600;
        color: #333;
        font-size: 14px;
    }
    
    .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e1e5e9;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s ease;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .btn {
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
        text-align: center;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .btn-success {
        background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
        color: white;
    }
    
    .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(86, 171, 47, 0.3);
    }
    
    .alert {
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 8px;
        border-left: 4px solid;
    }
    
    .alert-success {
        background-color: #d4edda;
        border-color: #28a745;
        color: #155724;
    }
    
    .alert-error {
        background-color: #f8d7da;
        border-color: #dc3545;
        color: #721c24;
    }
    
    .file-input-wrapper {
        position: relative;
        display: inline-block;
        cursor: pointer;
        width: 100%;
    }
    
    .file-input {
        opacity: 0;
        position: absolute;
        z-index: -1;
    }
    
    .file-input-label {
        display: block;
        padding: 12px 15px;
        border: 2px dashed #e1e5e9;
        border-radius: 8px;
        text-align: center;
        background: #f8f9fa;
        transition: all 0.3s ease;
    }
    
    .file-input-label:hover {
        border-color: #667eea;
        background: #f0f2ff;
    }
    
    .section-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #333;
        margin-bottom: 20px;
        text-align: center;
    }

    /* Responsive Styles */
    @media (max-width: 768px) {
        .admin-container {
            padding: 10px;
        }
        
        .admin-header {
            padding: 12px;
            margin-bottom: 15px;
        }
        
        .admin-header h1 {
            font-size: 1.5rem;
        }
        
        .admin-header p {
            font-size: 0.9rem;
        }
        
        .tab-button {
            padding: 10px 15px;
            font-size: 13px;
        }
        
        .tab-content {
            padding: 15px;
        }
        
        .form-grid {
            grid-template-columns: 1fr;
        }
        
        .btn {
            width: 100%;
            margin-bottom: 10px;
        }
        
        .form-control {
            font-size: 16px; /* Mejor tama√±o para inputs m√≥viles */
            padding: 10px 12px;
        }
        
        .section-title {
            font-size: 1.3rem;
        }
    }

    @media (max-width: 480px) {
        .admin-header h1 {
            font-size: 1.3rem;
        }
        
        .admin-tabs {
            margin-bottom: 15px;
        }
        
        .tab-button {
            padding: 8px 12px;
            font-size: 12px;
        }
        
        .form-group label {
            font-size: 13px;
        }
        
        .file-input-label {
            padding: 10px;
            font-size: 13px;
        }
        
        .alert {
            padding: 12px;
            font-size: 13px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>Panel de Administraci√≥n</h1>
        <p>Gestiona proveedores, categor√≠as, subcategor√≠as, productos y estatus</p>
    </div>
    
    <!-- Tabs de navegaci√≥n -->
    <div class="admin-tabs">
        <button class="tab-button active" onclick="showTab('proveedores')">Proveedores</button>
        <button class="tab-button" onclick="showTab('categorias')">Categor√≠as</button>
        <button class="tab-button" onclick="showTab('subcategorias')">Subcategor√≠as</button>
        <button class="tab-button" onclick="showTab('estatus')">Estatus</button>
        <button class="tab-button" onclick="showTab('productos')">Productos</button>
    </div>
    
    <!-- Mensajes de √©xito/error -->
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
    
    <!-- Tab: Proveedores -->
    <div id="proveedores" class="tab-content active">
        <h2 class="section-title">Gesti√≥n de Proveedores</h2>
        <form method="post" enctype="multipart/form-data" action="{% url 'productos:add_proveedor' %}">
            {% csrf_token %}
            <div class="form-grid">
                <div class="form-group">
                    <label for="proveedor_name">Nombre del Proveedor *</label>
                    <input type="text" id="proveedor_name" name="name" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="proveedor_id_unico">ID √önico *</label>
                    <input type="text" id="proveedor_id_unico" name="id_unico" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="proveedor_logo">Logo del Proveedor</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="proveedor_logo" name="logo" class="file-input" accept="image/*">
                        <label for="proveedor_logo" class="file-input-label">
                            üì∑ Seleccionar Logo
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="proveedor_catalogo">Cat√°logo (PDF)</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="proveedor_catalogo" name="catalogo" class="file-input" accept=".pdf">
                        <label for="proveedor_catalogo" class="file-input-label">
                            üìÑ Seleccionar Cat√°logo PDF
                        </label>
                    </div>
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary">‚ûï Agregar Proveedor</button>
        </form>
    </div>
    
    <!-- Tab: Categor√≠as -->
    <div id="categorias" class="tab-content">
        <h2 class="section-title">Gesti√≥n de Categor√≠as</h2>
        <form method="post" action="{% url 'productos:add_category' %}">
            {% csrf_token %}
            <div class="form-grid">
                <div class="form-group">
                    <label for="category_name">Nombre de la Categor√≠a *</label>
                    <input type="text" id="category_name" name="name" class="form-control" required>
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary">‚ûï Agregar Categor√≠a</button>
        </form>
    </div>
    
    <!-- Tab: Subcategor√≠as -->
    <div id="subcategorias" class="tab-content">
        <h2 class="section-title">Gesti√≥n de Subcategor√≠as</h2>
        <form method="post" action="{% url 'productos:add_subcategory' %}">
            {% csrf_token %}
            <div class="form-grid">
                <div class="form-group">
                    <label for="subcategory_name">Nombre de la Subcategor√≠a *</label>
                    <input type="text" id="subcategory_name" name="name" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="subcategory_category">Categor√≠a *</label>
                    <select id="subcategory_category" name="category" class="form-control" required>
                        <option value="">Seleccionar categor√≠a...</option>
                        {% for category in categories %}
                            <option value="{{ category.id }}">{{ category.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary">‚ûï Agregar Subcategor√≠a</button>
        </form>
    </div>
    
    <!-- Tab: Estatus -->
    <div id="estatus" class="tab-content">
        <h2 class="section-title">Gesti√≥n de Estatus de Procedencia</h2>
        <form method="post" action="{% url 'productos:add_estatus' %}">
            {% csrf_token %}
            <div class="form-grid">
                <div class="form-group">
                    <label for="estatus_name">Nombre del Estatus *</label>
                    <input type="text" id="estatus_name" name="name" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="estatus_description">Descripci√≥n</label>
                    <textarea id="estatus_description" name="description" class="form-control" rows="3" placeholder="Descripci√≥n opcional del estatus..."></textarea>
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary">‚ûï Agregar Estatus</button>
        </form>
    </div>
    
    <!-- Tab: Productos -->
    <div id="productos" class="tab-content">
        <h2 class="section-title">Gesti√≥n de Productos</h2>
        <form method="post" enctype="multipart/form-data" action="{% url 'productos:add_product' %}">
            {% csrf_token %}
            <div class="form-grid">
                <div class="form-group">
                    <label for="product_name">Nombre del Producto *</label>
                    <input type="text" id="product_name" name="name" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="product_sku">C√≥digo SKU</label>
                    <input type="text" id="product_sku" name="sku" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="product_proveedor">Proveedor</label>
                    <select id="product_proveedor" name="proveedor" class="form-control">
                        <option value="">Seleccionar proveedor...</option>
                        {% for proveedor in proveedores %}
                            <option value="{{ proveedor.id }}">{{ proveedor.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="product_category">Categor√≠a *</label>
                    <select id="product_category" name="category" class="form-control" required>
                        <option value="">Seleccionar categor√≠a...</option>
                        {% for category in categories %}
                            <option value="{{ category.id }}">{{ category.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="product_subcategory">Subcategor√≠a</label>
                    <select id="product_subcategory" name="subcategory" class="form-control">
                        <option value="">Seleccionar subcategor√≠a...</option>
                        {% for subcategory in subcategories %}
                            <option value="{{ subcategory.id }}" data-category="{{ subcategory.category.id }}">{{ subcategory.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="product_estatus">Estatus de Procedencia</label>
                    <select id="product_estatus" name="estatus" class="form-control">
                        <option value="">Seleccionar estatus...</option>
                        {% for estatus in estatus_list %}
                            <option value="{{ estatus.id }}">{{ estatus.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="product_price">Precio</label>
                    <input type="number" id="product_price" name="price" class="form-control" step="0.01" min="0">
                </div>
                
                <div class="form-group">
                    <label for="product_peso">Peso (kg)</label>
                    <input type="number" id="product_peso" name="peso" class="form-control" step="0.01" min="0">
                </div>
                
                <div class="form-group">
                    <label for="product_origen">Pa√≠s de Origen</label>
                    <input type="text" id="product_origen" name="origen" class="form-control">
                </div>
            </div>
            
            <div class="form-group">
                <label for="product_short_description">Descripci√≥n Corta</label>
                <input type="text" id="product_short_description" name="short_description" class="form-control" maxlength="500">
            </div>
            
            <div class="form-group">
                <label for="product_description">Descripci√≥n Completa</label>
                <textarea id="product_description" name="description" class="form-control" rows="4" placeholder="Descripci√≥n detallada del producto..."></textarea>
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="product_image">Imagen del Producto</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="product_image" name="image" class="file-input" accept="image/*">
                        <label for="product_image" class="file-input-label">
                            üñºÔ∏è Seleccionar Imagen
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="product_video">Video del Producto</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="product_video" name="video" class="file-input" accept="video/*">
                        <label for="product_video" class="file-input-label">
                            üé• Seleccionar Video
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="product_ficha_tecnica">Ficha T√©cnica (PDF)</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="product_ficha_tecnica" name="ficha_tecnica" class="file-input" accept=".pdf">
                        <label for="product_ficha_tecnica" class="file-input-label">
                            üìã Seleccionar Ficha T√©cnica
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label>
                    <input type="checkbox" id="product_is_active" name="is_active" checked> 
                    Producto Activo
                </label>
            </div>
            
            <button type="submit" class="btn btn-success">üõçÔ∏è Agregar Producto</button>
        </form>
    </div>
</div>

</div>

<script>
function showTab(tabName) {
    // Ocultar todas las pesta√±as
    const tabs = document.querySelectorAll('.tab-content');
    tabs.forEach(tab => tab.classList.remove('active'));
    
    // Desactivar todos los botones
    const buttons = document.querySelectorAll('.tab-button');
    buttons.forEach(button => button.classList.remove('active'));
    
    // Mostrar la pesta√±a seleccionada
    document.getElementById(tabName).classList.add('active');
    
    // Activar el bot√≥n correspondiente
    event.target.classList.add('active');
}

// Actualizar el nombre del archivo seleccionado
document.querySelectorAll('.file-input').forEach(input => {
    input.addEventListener('change', function() {
        const label = this.nextElementSibling;
        const fileName = this.files[0]?.name || label.getAttribute('data-original-text') || label.textContent;
        if (this.files[0]) {
            label.textContent = `üìÅ ${fileName}`;
        }
    });
});

// Guardar el texto original de las etiquetas
document.querySelectorAll('.file-input-label').forEach(label => {
    label.setAttribute('data-original-text', label.textContent);
});

// Filtrar subcategor√≠as por categor√≠a seleccionada
document.getElementById('product_category').addEventListener('change', function() {
    const categoryId = this.value;
    const subcategorySelect = document.getElementById('product_subcategory');
    const allOptions = subcategorySelect.querySelectorAll('option');
    
    // Mostrar todas las opciones primero
    allOptions.forEach(option => {
        if (option.value === '') {
            option.style.display = 'block';
        } else {
            const optionCategoryId = option.getAttribute('data-category');
            if (!categoryId || optionCategoryId === categoryId) {
                option.style.display = 'block';
            } else {
                option.style.display = 'none';
            }
        }
    });
    
    // Resetear selecci√≥n
    subcategorySelect.value = '';
});
</script>
{% endblock %}
