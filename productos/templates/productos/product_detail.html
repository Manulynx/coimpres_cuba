{% extends "coimpres_cuba/base.html" %}
{% load static %}

{% block title %}{{ object.name }} | Coimpres Cuba{% endblock %}

{% block content %}
<div class="container my-5">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'home' %}">Inicio</a></li>
            <li class="breadcrumb-item"><a href="{% url 'productos:product_list' %}">Productos</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ object.name }}</li>
        </ol>
    </nav>

    <div class="row">
        <div class="col-md-6 mb-4">
            {% if object.image %}
                <img src="{{ object.image.url }}" class="img-fluid rounded" alt="{{ object.name }}">
            {% else %}
                <img src="{% static 'img/no-image.jpg' %}" class="img-fluid rounded" alt="Sin imagen">
            {% endif %}
            
            {% if object.video_url %}
            <div class="mt-3">
                <h5>Video del producto:</h5>
                <div class="ratio ratio-16x9">
                    <iframe src="{{ object.video_url }}" allowfullscreen></iframe>
                </div>
            </div>
            {% endif %}
        </div>
        
        <div class="col-md-6">
            <h1 class="mb-3">{{ object.name }}</h1>
            
            {% if object.proveedor %}
            <div class="mb-3">
                <h5>Proveedor:</h5>
                <p>{{ object.proveedor.name }}</p>
                {% if object.proveedor.logo %}
                    <img src="{{ object.proveedor.logo.url }}" alt="{{ object.proveedor.name }}" class="img-fluid" style="max-height: 50px;">
                {% endif %}
            </div>
            {% endif %}
            
            {% if object.price %}
            <div class="mb-3">
                <h3>Precio: ${{ object.price }}</h3>
            </div>
            {% endif %}
            
            {% if object.short_description %}
            <div class="mb-3">
                <h5>Descripción corta:</h5>
                <p>{{ object.short_description }}</p>
            </div>
            {% endif %}
            
            {% if object.sku %}
            <div class="mb-3">
                <h5>Código SKU:</h5>
                <p>{{ object.sku }}</p>
            </div>
            {% endif %}
            
            <div class="mb-3">
                <h5>Categoría:</h5>
                <p><span class="category-badge">{{ object.category }}</span></p>
                {% if object.subcategory %}
                    <h5>Subcategoría:</h5>
                    <p><span class="badge bg-secondary">{{ object.subcategory.name }}</span></p>
                {% endif %}
                
                {% if object.status_procedencia %}
                <h5 class="mt-3">Disponibilidad:</h5>
                <p><span class="badge {% if object.status_procedencia.name == 'En stock' %}bg-success{% elif object.status_procedencia.name == 'Por pedido' %}bg-warning text-dark{% else %}bg-info{% endif %}">
                    {{ object.status_procedencia.name }}
                </span></p>
                {% endif %}
            </div>
            
            <div class="mb-4">
                <a href="https://wa.me/+5399999999?text=Hola, estoy interesado en el producto {{ object.name }}" class="btn btn-whatsapp btn-lg">
                    <i class="bi bi-whatsapp"></i> Contactar por WhatsApp
                </a>
            </div>
        </div>
    </div>
    
    <div class="row mt-4">
        <div class="col-12">
            <ul class="nav nav-tabs" id="productTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="description-tab" data-bs-toggle="tab" data-bs-target="#description" type="button" role="tab" aria-controls="description" aria-selected="true">Descripción</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="specs-tab" data-bs-toggle="tab" data-bs-target="#specs" type="button" role="tab" aria-controls="specs" aria-selected="false">Especificaciones</button>
                </li>
            </ul>
            <div class="tab-content p-4 border border-top-0 rounded-bottom" id="productTabsContent">
                <div class="tab-pane fade show active" id="description" role="tabpanel" aria-labelledby="description-tab">
                    {% if object.description %}
                        {{ object.description|linebreaks }}
                    {% else %}
                        <p>No hay descripción detallada disponible para este producto.</p>
                    {% endif %}
                </div>
                <div class="tab-pane fade" id="specs" role="tabpanel" aria-labelledby="specs-tab">
                    <div class="table-responsive">
                        <table class="table">
                            <tbody>
                                {% if object.origen %}
                                <tr>
                                    <th scope="row">País de origen</th>
                                    <td>{{ object.origen }}</td>
                                </tr>
                                {% endif %}
                                {% if object.peso %}
                                <tr>
                                    <th scope="row">Peso</th>
                                    <td>{{ object.peso }} kg</td>
                                </tr>
                                {% endif %}
                                {% if object.status_procedencia %}
                                <tr>
                                    <th scope="row">Status de procedencia</th>
                                    <td>{{ object.status_procedencia }}</td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                    
                    {% if object.ficha_tecnica %}
                    <div class="mt-3">
                        <a href="{{ object.ficha_tecnica.url }}" class="btn btn-outline-primary" target="_blank">
                            <i class="bi bi-file-earmark-pdf"></i> Descargar ficha técnica
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Productos relacionados en carrusel -->
    {% if related_products %}
    <div class="related-products-section mt-5">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="mb-0">Productos relacionados</h3>
            <div class="d-none d-md-flex gap-2">
                <button class="btn btn-outline-secondary btn-sm related-prev" aria-label="Anterior">
                    <i class="bi bi-chevron-left"></i>
                </button>
                <button class="btn btn-outline-secondary btn-sm related-next" aria-label="Siguiente">
                    <i class="bi bi-chevron-right"></i>
                </button>
            </div>
        </div>
        <div class="related-carousel-wrapper position-relative">
            <div class="related-carousel-track" data-items="{{ related_products|length }}">
                {% for related_product in related_products %}
                <div class="related-item">
                    <div class="related-card h-100">
                        <div class="related-image-wrapper">
                            {% if related_product.image %}
                                <img src="{{ related_product.image.url }}" alt="{{ related_product.name }}" loading="lazy">
                            {% else %}
                                <img src="{% static 'img/no-image.jpg' %}" alt="Sin imagen" loading="lazy">
                            {% endif %}
                            <div class="related-overlay">
                                <a href="{% url 'productos:product_detail' related_product.slug %}" class="btn btn-sm btn-light fw-semibold shadow-sm">Ver detalle</a>
                            </div>
                        </div>
                        <div class="p-3">
                            <h6 class="mb-1 text-truncate" title="{{ related_product.name }}">{{ related_product.name }}</h6>
                            <p class="small text-muted mb-2 text-truncate" title="{{ related_product.short_description }}">{{ related_product.short_description|default:""|truncatechars:70 }}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                {% if related_product.price %}
                                <span class="price-tag">${{ related_product.price }}</span>
                                {% else %}
                                <span class="small text-muted">Consultar</span>
                                {% endif %}
                                <a href="{% url 'productos:product_detail' related_product.slug %}" class="stretched-link d-inline-block ms-2 text-accent small">→</a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            <!-- Controles móviles -->
            <button class="btn btn-outline-secondary btn-sm related-prev mobile-control" aria-label="Anterior">
                <i class="bi bi-chevron-left"></i>
            </button>
            <button class="btn btn-outline-secondary btn-sm related-next mobile-control" aria-label="Siguiente">
                <i class="bi bi-chevron-right"></i>
            </button>
            <div class="fade-edge left"></div>
            <div class="fade-edge right"></div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script src="{% static 'js/related-carousel.js' %}"></script>
{% endblock %}

{% block extra_css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'css/related-carousel.css' %}">
{% endblock %}